<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEVEL-UP ARENA</title>
    
    <!-- CSS Styles - All styles are inside this file -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Teko:wght@400;600;700&display=swap');

        :root {
            --brand-dark: #111827;
            --brand-surface: #1F2937;
            --brand-primary: #00F5FF;
            --brand-secondary: #E025CE;
            --brand-danger: #F87171;
            --brand-warning: #FACC15;
            --text-light: #F9FAFB;
            --text-muted: #9CA3AF;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #000000;
            background-image: url('https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/dfdc00fc6bb93771364bbf5000dad222.jpg?alt=media&token=ff33f08b-1b2e-424e-b636-f664d8044bed');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-light);
            overflow-x: hidden;
            transition: background 0.5s ease-in-out;
        }
        
        /* This class will be added to body for the black login background */
        body.login-active {
            background-image: none;
            background-color: #000000;
        }
        
        .bg-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.6); z-index: -1; }
        .hidden { display: none !important; }

        /* ======== NEW SPLASH/LOADING SCREEN (নতুন লোডিং স্ক্রিন) ======== */
        #loading-spinner {
            position: fixed; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; z-index: 100; flex-direction: column; gap: 1rem;
        }
        .splash-logo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 2rem;
            animation: pulse 1.5s infinite ease-in-out;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top: 4px solid var(--brand-primary); width: 50px; height: 50px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }

        /* ======== PREMIUM LOGIN SCREEN CSS (আপডেটেড লগইন পেজের ডিজাইন) ======== */
        #login-screen {
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 1rem; position: relative; z-index: 1; animation: fadeIn 1s ease-in-out;
        }
        
        #premium-logo-container {
            margin-bottom: 2rem;
            cursor: default; /* Make it not look clickable */
        }

        #premium-logo-container img {
            width: 180px;
            height: 180px; /* Force square for perfect circle */
            border-radius: 50%; /* Make it round */
            object-fit: cover;
            border: 3px solid rgba(0, 245, 255, 0.5); /* Subtle neon border */
            
            /* Remove all visual feedback on hover/click */
            transition: none;
            transform: none;
            filter: none;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }
        #premium-logo-container img:hover {
            transform: none; /* Explicitly disable hover effect */
        }

        .login-box {
            padding: 2.5rem 2rem; background: rgba(20, 20, 30, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); width: 100%; max-width: 400px;
        }
        .login-box h2 { font-family: 'Teko', sans-serif; font-size: 2.5rem; color: var(--text-light); margin-bottom: 0.5rem; letter-spacing: 1px; }
        .login-box p { color: var(--text-muted); margin-bottom: 2rem; }
        .google-login-btn {
            width: 100%; display: flex; align-items: center; justify-content: center; gap: 1rem; padding: 0.8rem 1rem; border-radius: 8px; border: 1px solid var(--brand-primary); background-color: transparent; color: var(--text-light); font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease;
        }
        .google-login-btn:hover { background-color: var(--brand-primary); color: var(--brand-dark); box-shadow: 0 0 20px var(--brand-primary); }
        .google-login-btn img { width: 24px; height: 24px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* ======== MAIN APP & OTHER SECTIONS ======== */
        .app-container { display: flex; min-height: 100vh; }
        .main-content { flex-grow: 1; padding: 2rem; }
        #user-app header {
            background-color: rgba(31, 41, 55, 0.8); backdrop-filter: blur(10px); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--brand-primary);
        }
        #user-app .logo { font-family: 'Teko', sans-serif; font-size: 1.8rem; color: var(--brand-primary); }
        #user-app nav a, #user-app button { color: var(--text-light); text-decoration: none; margin-left: 1.5rem; font-weight: 500; transition: color 0.3s; }
        #user-app nav a:hover { color: var(--brand-primary); }
        .logout-btn { background: var(--brand-danger); border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; }
        .profile-card { background: var(--brand-surface); padding: 2rem; border-radius: 8px; max-width: 700px; margin: 2rem auto; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); }
        .profile-card img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--brand-primary); object-fit: cover; }
        .profile-field { margin-bottom: 1.5rem; }
        .profile-field label { display: block; color: var(--text-muted); margin-bottom: 0.5rem; font-size: 0.9rem; }
        .profile-field .value { background: #2d3a4c; padding: 0.75rem; border-radius: 6px; }
        .input-field { width: 100%; background: #2d3a4c; border: 1px solid #4a5568; padding: 0.75rem; border-radius: 6px; color: var(--text-light); }
        .action-btn { background-color: var(--brand-primary); color: var(--brand-dark); border: none; padding: 0.6rem 1.2rem; border-radius: 6px; cursor: pointer; font-weight: bold; transition: transform 0.2s; }
        .action-btn:hover { transform: scale(1.05); }
        #admin-app { background-color: transparent; }
        #admin-sidebar { width: 250px; background-color: var(--brand-dark); padding: 1.5rem; display: flex; flex-direction: column; border-right: 1px solid #30363d; }
        .admin-header { text-align: center; padding-bottom: 1.5rem; border-bottom: 1px solid #30363d; margin-bottom: 1.5rem; }
        .admin-header .logo { font-family: 'Teko', sans-serif; font-size: 2rem; color: var(--brand-warning); }
        .admin-header .role-indicator { background: var(--brand-warning); color: var(--brand-dark); padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: bold; display: inline-block; margin-top: 0.5rem; }
        #admin-sidebar nav a { color: var(--text-muted); text-decoration: none; display: block; padding: 0.8rem; border-radius: 6px; margin-bottom: 0.5rem; transition: all 0.3s; }
        #admin-sidebar nav a:hover, #admin-sidebar nav a.active { background-color: var(--brand-surface); color: var(--text-light); }
        .admin-logout { margin-top: auto; }
        .admin-table-container { background-color: var(--brand-surface); border-radius: 8px; overflow: hidden; }
        .admin-table { width: 100%; border-collapse: collapse; }
        .admin-table th, .admin-table td { padding: 1rem; text-align: left; }
        .admin-table thead { background-color: #2d3a4c; }
        .admin-table tbody tr { border-bottom: 1px solid #30363d; }
        .admin-table tbody tr:last-child { border-bottom: none; }
        .admin-table tbody tr.locked-user { background-color: rgba(248, 113, 113, 0.1); opacity: 0.7; }
        .admin-table .action-cell button { background: none; border: none; cursor: pointer; color: var(--text-muted); padding: 0.5rem; }
        .admin-table .action-cell button:hover { color: var(--text-light); }
        #user-search { width: 100%; max-width: 400px; padding: 0.75rem; background: var(--brand-surface); border: 1px solid #30363d; border-radius: 6px; color: var(--text-light); margin-bottom: 1.5rem; }
        @media (max-width: 768px) {
            .app-container { flex-direction: column; }
            #admin-sidebar { width: 100%; height: auto; flex-direction: row; justify-content: space-between; align-items: center; border-right: none; border-bottom: 1px solid #30363d; }
            #admin-sidebar .admin-header { border: none; margin: 0; padding: 0; }
            #admin-sidebar nav { display: flex; }
            #admin-sidebar nav a { margin: 0 0.5rem; }
            .admin-logout { margin-top: 0; }
        }
    </style>
</head>
<body>
    <div class="bg-overlay"></div>

    <!-- ======== LOADING / SPLASH SCREEN ======== -->
    <div id="loading-spinner">
        <img src="https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/dfdc00fc6bb93771364bbf5000dad222.jpg?alt=media&token=ff33f08b-1b2e-424e-b636-f664d8044bed" alt="Logo" class="splash-logo">
        <div class="spinner"></div>
    </div>

    <!-- ======== LOGIN SCREEN (আপডেটেড ডিজাইন) ======== -->
    <section id="login-screen" class="hidden">
        <div id="premium-logo-container">
            <img src="https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/dfdc00fc6bb93771364bbf5000dad222.jpg?alt=media&token=ff33f08b-1b2e-424e-b636-f664d8044bed" alt="Level-Up Arena Logo">
        </div>
        <div class="login-box">
            <h2>WELCOME, PLAYER</h2>
            <p>Your ultimate esports journey begins now.</p>
            <button id="google-login-btn" class="google-login-btn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google Logo">
                <span>Sign in with Google</span>
            </button>
        </div>
    </section>

    <!-- ======== USER APPLICATION ======== -->
    <section id="user-app" class="hidden">
        <header>
            <div class="logo">LEVEL-UP</div>
            <nav>
                <a href="#" onclick="showUserPage('user-dashboard')">Dashboard</a>
                <a href="#" onclick="showUserPage('user-profile')">Profile</a>
                <button id="user-logout-btn" class="logout-btn">Logout</button>
            </nav>
        </header>
        <main class="main-content">
            <div id="user-dashboard">
                <h1>Welcome, <span id="user-welcome-name">Player</span>!</h1>
                <p>Matches and other features will be shown here.</p>
            </div>
            <div id="user-profile" class="hidden">
                <div class="profile-card">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                        <img id="profile-img" src="https://via.placeholder.com/100" alt="Profile Picture">
                        <div>
                            <input type="file" id="image-upload" accept="image/*" class="hidden">
                            <button class="action-btn" onclick="document.getElementById('image-upload').click()">Change Image</button>
                            <button id="upload-confirm-btn" class="action-btn hidden" style="background-color: #22c55e;">Confirm Upload</button>
                        </div>
                    </div>
                    <div class="profile-field">
                        <label>Email</label>
                        <div id="profile-email" class="value"></div>
                    </div>
                    <div class="profile-field">
                        <label>Display Name</label>
                        <div id="display-name-view">
                            <span id="profile-display-name" class="value" style="width: 100%; display:inline-block;"></span>
                            <button onclick="toggleNameEdit(true)" style="margin-left: 10px; background: none; border: none; color: var(--brand-primary); cursor: pointer;">Edit</button>
                        </div>
                        <div id="display-name-edit" class="hidden" style="display: flex; gap: 10px;">
                            <input type="text" id="display-name-input" class="input-field">
                            <button id="save-name-btn" class="action-btn">Save</button>
                        </div>
                    </div>
                    <div class="profile-field">
                        <label>Referral Code</label>
                        <div class="value" style="display: flex; justify-content: space-between; align-items: center;">
                            <span id="profile-referral-code" style="font-family: monospace;"></span>
                            <button id="copy-referral-btn" style="background: none; border: none; color: var(--brand-primary); cursor: pointer;">Copy</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </section>

    <!-- ======== ADMIN PANEL ======== -->
    <section id="admin-app" class="app-container hidden">
        <aside id="admin-sidebar">
            <div class="admin-header">
                <div class="logo">ARENA</div>
                <span class="role-indicator">ADMIN</span>
            </div>
            <nav>
                <a href="#" onclick="showAdminPage('admin-dashboard')">Dashboard</a>
                <a href="#" onclick="showAdminPage('admin-users')">Users</a>
            </nav>
            <button id="admin-logout-btn" class="logout-btn admin-logout">Logout</button>
        </aside>
        <main class="main-content">
            <div id="admin-dashboard">
                <h1>Admin Dashboard</h1>
                <p>Key metrics and app controls will be here.</p>
            </div>
            <div id="admin-users" class="hidden">
                <h1>User Management</h1>
                <input type="text" id="user-search" placeholder="Search by name, email, or referral code...">
                <div class="admin-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Email</th>
                                <th>Referral Code</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </section>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, serverTimestamp, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js";

        const firebaseConfig = {
          apiKey: "AIzaSyB2I3GJh68NXzopOgbpKtHUp3O1Au3wVcc",
          authDomain: "level-up-esports.firebaseapp.com",
          projectId: "level-up-esports",
          storageBucket: "level-up-esports.firebasestorage.app",
          messagingSenderId: "54066927114",
          appId: "1:54066927114:android:3ad0d0ec07451fd9a371f3" 
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const googleProvider = new GoogleAuthProvider();

        let currentUser = null, currentUserProfile = null, isAdmin = false;
        
        const loadingSpinner = document.getElementById('loading-spinner');
        const loginScreen = document.getElementById('login-screen');
        const userApp = document.getElementById('user-app');
        const adminApp = document.getElementById('admin-app');

        let adminClickCount = 0;
        document.getElementById('premium-logo-container').addEventListener('click', () => {
            adminClickCount++;
            if (adminClickCount >= 15) {
                const pin = prompt("Enter Admin PIN:");
                if (pin === '5449xshezin') {
                    isAdmin = true;
                    showScreen('admin');
                } else if (pin) {
                    alert("Invalid PIN.");
                }
                adminClickCount = 0;
            }
        });

        document.getElementById('google-login-btn').addEventListener('click', async () => {
            try {
                const result = await signInWithPopup(auth, googleProvider);
                const user = result.user;
                const userRef = doc(db, 'users', user.uid);
                const docSnap = await getDoc(userRef);
                if (!docSnap.exists()) {
                    await setDoc(userRef, {
                        uid: user.uid, displayName: user.displayName, email: user.email, photoURL: user.photoURL,
                        referralCode: `LUA-${Math.random().toString(36).substring(2, 10).toUpperCase()}`,
                        createdAt: serverTimestamp(), isLocked: false,
                    });
                }
            } catch (error) { console.error("Google Login Error:", error); alert("Could not log in with Google."); }
        });

        const handleLogout = () => {
            if (isAdmin) { isAdmin = false; showScreen('login'); } else { signOut(auth); }
        };
        document.getElementById('user-logout-btn').addEventListener('click', handleLogout);
        document.getElementById('admin-logout-btn').addEventListener('click', handleLogout);

        onAuthStateChanged(auth, async (user) => {
            if(user){
                currentUser = user;
                const docSnap = await getDoc(doc(db, 'users', user.uid));
                if (docSnap.exists()) {
                    currentUserProfile = docSnap.data();
                    if (currentUserProfile.isLocked) { alert("Your account has been locked."); signOut(auth); return; }
                    renderUserProfile(); showScreen('user');
                }
            } else {
                currentUser = null; currentUserProfile = null;
                if (!isAdmin) { showScreen('login'); }
            }
            loadingSpinner.classList.add('hidden');
        });

        function showScreen(screen) {
            loginScreen.classList.add('hidden');
            userApp.classList.add('hidden');
            adminApp.classList.add('hidden');
            document.body.classList.remove('login-active');
            
            if (screen === 'login') {
                loginScreen.classList.remove('hidden');
                document.body.classList.add('login-active');
            } else if (screen === 'user') {
                userApp.classList.remove('hidden');
            } else if (screen === 'admin') {
                adminApp.classList.remove('hidden');
                showAdminPage('admin-dashboard');
            }
        }

        window.showUserPage = (pageId) => {
            document.getElementById('user-dashboard').classList.add('hidden');
            document.getElementById('user-profile').classList.add('hidden');
            document.getElementById(pageId).classList.remove('hidden');
        }
        window.showAdminPage = (pageId) => {
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('admin-users').classList.add('hidden');
            document.getElementById(pageId).classList.remove('hidden');
            if (pageId === 'admin-users') renderAdminUsers();
        }

        function renderUserProfile() {
            if (!currentUserProfile) return;
            document.getElementById('user-welcome-name').textContent = currentUserProfile.displayName;
            document.getElementById('profile-img').src = currentUserProfile.photoURL;
            document.getElementById('profile-email').textContent = currentUserProfile.email;
            document.getElementById('profile-display-name').textContent = currentUserProfile.displayName;
            document.getElementById('display-name-input').value = currentUserProfile.displayName;
            document.getElementById('profile-referral-code').textContent = currentUserProfile.referralCode;
        }

        window.toggleNameEdit = (isEditing) => {
            document.getElementById('display-name-view').classList.toggle('hidden', isEditing);
            document.getElementById('display-name-edit').classList.toggle('hidden', !isEditing);
        }
        document.getElementById('save-name-btn').addEventListener('click', async () => {
            const newName = document.getElementById('display-name-input').value;
            if (newName && newName !== currentUserProfile.displayName) {
                await updateDoc(doc(db, 'users', currentUser.uid), { displayName: newName });
                currentUserProfile.displayName = newName; renderUserProfile(); toggleNameEdit(false); alert('Display name updated!');
            }
        });
        document.getElementById('copy-referral-btn').addEventListener('click', () => { navigator.clipboard.writeText(currentUserProfile.referralCode); alert('Referral code copied!'); });
        
        let fileToUpload = null;
        const uploadConfirmBtn = document.getElementById('upload-confirm-btn');
        document.getElementById('image-upload').addEventListener('change', (e) => {
            fileToUpload = e.target.files[0];
            if(fileToUpload) uploadConfirmBtn.classList.remove('hidden');
        });
        uploadConfirmBtn.addEventListener('click', async () => {
            if (!fileToUpload) return;
            uploadConfirmBtn.textContent = "Uploading...";
            const storageRef = ref(storage, `profileImages/${currentUser.uid}`);
            await uploadBytes(storageRef, fileToUpload);
            const photoURL = await getDownloadURL(storageRef);
            await updateDoc(doc(db, 'users', currentUser.uid), { photoURL });
            currentUserProfile.photoURL = photoURL; renderUserProfile();
            uploadConfirmBtn.classList.add('hidden'); uploadConfirmBtn.textContent = "Confirm Upload"; fileToUpload = null; alert('Profile image updated!');
        });

        let allUsers = [];
        async function renderAdminUsers() {
            const tableBody = document.getElementById('users-table-body');
            tableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Loading users...</td></tr>';
            const querySnapshot = await getDocs(collection(db, "users"));
            allUsers = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            displayUsers(allUsers);
        }
        function displayUsers(usersToDisplay) {
            const tableBody = document.getElementById('users-table-body');
            tableBody.innerHTML = usersToDisplay.length === 0 ? '<tr><td colspan="4" style="text-align: center;">No users found.</td></tr>' : '';
            usersToDisplay.forEach(user => {
                const row = document.createElement('tr');
                if (user.isLocked) row.classList.add('locked-user');
                row.innerHTML = `<td><div style="display:flex;align-items:center;gap:10px;"><img src="${user.photoURL}" alt="" style="width:40px;height:40px;border-radius:50%;"><span>${user.displayName}</span></div></td><td>${user.email}</td><td style="font-family:monospace;">${user.referralCode}</td><td class="action-cell"><button onclick="toggleUserLock('${user.id}', ${user.isLocked})">${user.isLocked ? `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="lightgreen" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>` : `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--brand-danger)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`}</button></td>`;
                tableBody.appendChild(row);
            });
        }
        document.getElementById('user-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredUsers = allUsers.filter(user => user.displayName?.toLowerCase().includes(searchTerm) || user.email?.toLowerCase().includes(searchTerm) || user.referralCode?.toLowerCase().includes(searchTerm));
            displayUsers(filteredUsers);
        });
        window.toggleUserLock = async (userId, isLocked) => {
            const action = isLocked ? "unlock" : "lock";
            if (confirm(`Are you sure you want to ${action} this user?`)) {
                await updateDoc(doc(db, 'users', userId), { isLocked: !isLocked });
                alert(`User has been ${action}ed.`); renderAdminUsers();
            }
        };
    </script>
</body>
                </html>
